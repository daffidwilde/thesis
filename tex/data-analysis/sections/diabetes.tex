\section{Taking a slice: diabetic patient analysis}\label{sec:diabetes}

The main conclusion to be taken away from the previous summative analysis is
that the dataset contains a huge amount of variation. Therefore, in order to
conduct more meaningful analysis, more homogeneous subsets of the data must be
considered.

Classically, patients are categorised by age or condition. However, it has been
shown that doing so often gives an unrepresentative slice of
patients~\cite{Vuik2016}. In this section, the focus will be on the diabetic
population within the dataset despite this potential danger as it provides a
good example of condition-based slicing and is of interest to public health
groups.

Since diabetes is recorded only as a primary or secondary condition in the
dataset and is not distinguished by type, the diabetic population is considered
to be any instance where diabetes is present.

The ensuing analysis will provide evidence that the diabetic population is
increasing in the Cwm Taf area, and that, despite this, the relative resource
consumption by diabetic patients has been stagnant over the data period. It will
also be seen that this population holds too much variation to make meaningful 
conclusions about the population on the whole. However, by considering a subset
based on a condition such as this, there is a natural opportunity to compare
the subset with its complement; by considering the differences and similarities
between these two datasets a new dimension is added to the analysis.


\subsection{Distributions and summative statistics}%
\label{subsec:diab_dists_stats}

In much the same way as in Section~\ref{subsec:distributions_statistics}, taking
an overview of the key attributes provides some idea about how costs are
represented in the data.
Figures~\ref{fig:diab_no_spells_bar}~\--~\ref{fig:diab_netcost_kde} show
the same statistics as in the summative analysis though these figures have two
additional components: (a) in the case of bar charts, separate plots for overall
frequency and frequency density, and (b) a comparison with the non-diabetic
population on the same axes. The purpose of the separate bar charts is to show,
firstly, the relative sizes between the groups and their bins, and then to be
able to directly compare their distributions.

As before, the distributions of the diabetic population have long tails but they
are often heavier than the general or non-diabetic populations which are
arguably interchangeable given their sizes. This extra weight in the tails
suggests that diabetic patients are more likely to experience severe periods of
illness, and this is bolstered by the complete difference in the shape of the
distribution of maximal diagnosis numbers pictured in
Figure~\ref{fig:diab_no_diag_bar}.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\imgwidth]{no_spells_bar/main.pdf}
    \caption{Bar chart for the number of spells associated with a patient in the
        presence of diabetes and not.}%
    \label{fig:diab_no_spells_bar}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\imgwidth]{los_bar/main.pdf}
    \caption{Bar chart for the total length of a spell in the presence of
        diabetes and not, clipped at 21 days. \textit{Maximum 705 days.}}%
    \label{fig:diab_los_bar}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\imgwidth]{no_diag_bar/main.pdf}
    \caption{Bar chart for the maximum number of diagnoses in a spell in the
        presence of diabetes and not.}%
    \label{fig:diab_no_diag_bar}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\imgwidth]{no_proc_bar/main.pdf}
    \caption{Bar chart for the total number of procedures in a spell in the
        presence of diabetes and not.}%
    \label{fig:diab_no_proc_bar}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\imgwidth]{netcost_kde/main.pdf}
    \caption{Estimated probability density for the net cost of a spell in the
        presence of diabetes and not, clipped at \pounds12,500. \textit{Maximum
        approx. \pounds369,000.}}%
    \label{fig:diab_netcost_kde}
\end{figure}

Other than diagnosis numbers, the shapes of the distributions here are
comparable. As stated, the tails are heavier across the board for the diabetic
population. With that being true, it follows that the noses are substantially
lighter. This is evident most clearly in Figures~\ref{fig:diab_no_spells_bar},~%
\ref{fig:diab_los_bar},~\ref{fig:diab_no_proc_bar}~\&~\ref{fig:diab_netcost_kde}
which imply that diabetic patients are more likely to return, have more
procedures and stay longer in the hospital whilst typically incurring higher
costs than non-diabetic patients. These all suggest that diabetic patients
represent a population of patients and spells that are more severe on average
than the typical patient, and thus will likely have a larger effect on the
hospital system on the whole. Again, a more detailed breakdown of the skeleton
for each of these attributes as well as the other key attributes is given in
Table~\ref{tab:diab_summative}. This table also shows a comparison between both
populations being considered in this section.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\imgwidth]{age_bar/main.pdf}
    \caption{Bar chart for the age of patients in the presence of diabetes and
        not.}%
    \label{fig:diab_age_bar}
\end{figure}

The distribution of patients' age is given in Figure~\ref{fig:diab_age_bar} and
quite clearly shows how unrepresentative a slice the diabetic population can be
\-- as was discussed above. Here, when looking at the frequency density plot,
all the intricacies in the shape of the age distribution for the entire dataset
and the non-diabetic population are dropped. Instead, the distribution indicates
negative skew and disproportionate amount of older patients. Thus, considering
the diabetic population is similar to just considering older patients since they
dominate the population.

However, the small number of younger diabetic patients
that remain could be polluting the population and this analysis. A remedy for
this would be to consider two or more diabetic populations based on their age
and perhaps a combination of other attributes including severity or total cost.
Deciding meaningful populations like these would require a large amount of
potentially arbitrary splitting on, or estimation of, such attributes. As such,
these methods will be avoided since they are not guaranteed to be appropriate or
robust.


\begin{table}[htbp]
    \vspace{-40pt}
    \resizebox{\imgwidth}{!}{%
        \input{./tex/diab_summative_stats0.tex}
    }

    \vspace{3pt}

    \resizebox{\imgwidth}{!}{%
        \input{./tex/diab_summative_stats1.tex}
    }

    \vspace{3pt}
    
    \resizebox{\imgwidth}{!}{%
        \input{./tex/diab_summative_stats2.tex}
    }

    \vspace{3pt}

    \resizebox{\imgwidth}{!}{%
        \input{./tex/diab_summative_stats3.tex}
    }

    \vspace{3pt}

    \resizebox{\imgwidth}{!}{%
        \input{./tex/diab_summative_stats4.tex}
    }

    \vspace{3pt}

    \resizebox{\imgwidth}{!}{%
        \input{./tex/diab_summative_stats5.tex}
    }

    \thisfloatpagestyle{empty}
    \caption{Summative spell-level statistics for each of the key attributes. In
        each column the diabetic population's statistic in followed by the
        corresponding non-diabetic statistic in brackets.}%
    \label{tab:diab_summative}
\end{table}


\subsection{Pairwise correlation}\label{subsec:diab_correlation}

With an overview of how the key attributes are distributed in mind, as before,
it is a good idea to see how these attributes interact with one another. In
Figure~\ref{fig:diab_corr_heatmap}, the Pearson correlation coefficients
are shown between each of the pairs of the key attributes in the diabetic
population. Again, the attributes have been ranked in descending order according
to their summed absolute correlation coefficient (see
Definition~\ref{def:absolute_correlation}) to determine those with the highest
levels of interaction.

\begin{figure}[htbp]
    \makebox[\textwidth]{%
        \centering
        \includegraphics[height=.6\paperheight]{corr_heatmap/with_nums.pdf}
    }
    \caption{A heat map of the pairwise correlation coefficients for the key
        cost attributes in diabetic patients. The attributes have been ordered
        according to their summed absolute correlation coefficient.}%
    \label{fig:diab_corr_heatmap}
\end{figure}

\begin{figure}[htbp]
    \makebox[\textwidth]{%
        \centering
        \includegraphics[height=.6\paperheight]{corr_difference/with_nums.pdf}
    }
    \caption{A heat map of the difference in pairwise correlation coefficients
        between the diabetic and general populations. These attributes have been
        ordered according to the sum of their absolute values.}%
    \label{fig:diab_corr_difference}
\end{figure}

To more clearly see the subtleties between these correlation coefficients and
those in Figure~\ref{fig:corr_heatmap}, another heat map has been included to
show their differences in Figure~\ref{fig:diab_corr_difference}. This heat
map utilises a different colour map to reflect this, and the attributes have
been ranked in descending order of their summed absolute differences. From this
figure it is seen that drug and therapy costs (DRUG and THER respectively) have
the largest total difference in correlation coefficients. In fact, the sign of
these differences are in line with those coefficients in both of the previous
heat maps meaning that these attributes are more strongly correlated amongst
diabetic patients than for the general population.

However, other than a small number of attributes at the top, this difference
heat map shows that the vast majority of correlation coefficients are unaffected
by considering the diabetic population alone. Given the large amounts of
variation and low levels of correlation seen in Section~\ref{subsec:corr}, this
is unsurprising but where there are differences suggests potential areas of
interest when comparing the corresponding diabetic variation with the
non-diabetic and general populations.


\subsection{Variation and relative importance}\label{subsec:diab_variation}

Again, it has been established how the key attributes are distributed and
interact in both the diabetic and non-diabetic populations. From here, the 
remaining component of the methodology established in Section~\ref{sec:overview}
is to investigate variation and importance.
Figures~\ref{fig:diab_variation}~\&~\ref{fig:diab_contribution} show these
quantities, and are ranked as in Figure~\ref{fig:diab_corr_heatmap}.

\begin{figure}[h]
    \centering
    \includegraphics[width=\imgwidth]{cost_variation/main.pdf}
    \caption{Bar chart showing the coefficient of variation \(C_{v}\) of each
        cost component, and the net and total costs, in the presence of diabetes
        and not.}%
    \label{fig:diab_variation}
\end{figure}

\begin{figure}[h]
    \centering
    \includegraphics[width=\imgwidth]{cost_contribution/main.pdf}
    \caption{Bar chart showing the average contribution of each cost component
        to the net cost of a spell in the presence of diabetes and not.}%
    \label{fig:diab_contribution}
\end{figure}

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{cost_bubble_plot/main.pdf}
    \caption{A bubble plot showing a comparison between the diabetic and
        non-diabetic populations' average contribution to the net cost of a
        spell along the vertical, and the coefficient of variation for that
        component as the size of its marker.}%
    \label{fig:diab_bubble_plot}
\end{figure}

Aside from the change in the order of the attributes compared with
Figure~\ref{fig:cost_variation}, this plot is largely similar: more weakly
correlated attributes tend to be more highly varied and the overall level of
relative variation is high. Having said that, the diabetic population is
consistently less than, or similarly, varied in each instance except operating
theatre (OPTH), radiotherapy (RADTH) and endoscopy (ENDO) costs which implies
that this subset of the dataset is in fact somewhat more homogeneous, as
desired.

Inspecting Figure~\ref{fig:diab_contribution} tells a similar story as with the
general population. That is, the dominant cost components are still overheads,
medical and ward costs, and the least correlated (and often most varied)
components are insignificant in their contribution to net costs. However, there
is a certain interest in the increased contribution from ward costs and those
from specific departments such as pharmacy (PHAR), pathology (PATH), and imaging
(IMG). The apparent increase in the likelihood, severity and length of diabetic
patient spells seen in Table~\ref{tab:diab_summative} \-- and alluded to by the
heavier tails in
Figures~\ref{fig:diab_no_spells_bar}~\--~\ref{fig:diab_no_proc_bar} \-- seems to
be linked to a rise in costs more generally which can be rationalised given
that this population all exhibit at least one chronic disease that is known to
have several comorbidities and knock-on effects more widely associated with a
patient's well-being~\cite{Deschenes2015}~\cite{Klimek2015}~\cite{Walker2016}.

In much the same way as in the previous section, the bubble plot shown in
Figure~\ref{fig:diab_bubble_plot} allows these quantities to be considered
simultaneously, and again, there is little to gain from its information. There
are no distinctly important components here and the system seems to be optimised
for both the diabetic and non-diabetic populations. That is, to the point where
the smallest relative variation of a component is still twice its mean.

So what was there to gain by looking at the diabetic population? From this
surface-level analysis, it was found that the diabetic population is marginally
more homogeneous than the general or non-diabetic population but that it still
exhibits a large amount of variation. This was to be expected since the decision
to look at diabetic patients was effectively arbitrary, and was not descriptive
enough to indicate that any particular kind of patient was being investigated
other than that they must exhibit this one condition. So, in that way, there was
little to gain. However, as has been noted throughout this analysis, taking a
subset of the population allows for some comparison with its complement
(depicted in most
Figures~\ref{fig:diab_no_spells_bar}~through~\ref{fig:diab_bubble_plot}) as well
as the entire dataset. Comparisons of the latter form will be discussed further
in the remainder of this analysis.


\subsection{Resource consumption}\label{subsec:diab_resources}

The types of comparisons made between the non-diabetic and diabetic populations
throughout this analysis are useful for observing their similarities in a direct
way, and in understanding how the groups may relate to one another.

However, these are not the only devices available for examining such a subset of
the data. Particularly when looking at costing data such as this, another useful
way of evaluating a subset is to quantify its size and representation in the
data with respect to various cost-indicative attributes. These attributes can
give a sense of the level and nature of the resources that are consumed by the
population in question. Namely, these attributes are: the proportion of total
net costs and admissions, and length of stay. During this part of the analysis,
these attributes will be referred to as the ``chosen'' attributes.

In addition, whilst considering that costs are the focus of this body of work,
it can be useful to investigate how certain cost-related quantities evolve for a
subset of the population. In this section of the analysis, the evolution of the
aforementioned attributes will be discussed within the diabetic population as a
part of the general data population. For these purposes, the data must be
manipulated into a chronological form and so some approximations have to be
made. Here, each of the chosen attributes is given with respect to a particular
admission date, and has been calculated in the following way for each admission
date:

\begin{itemize}
    \item \textbf{Proportion of total admissions:} Take the number of unique
        spells for diabetic patients admitted on that day, \(n_d\), and the
        total number of unique spells with that admission date, \(N\). The
        proportion of total admissions on that day from diabetic patients is
        given by \(\frac{n_d}{N}\).
    \item \textbf{Average length of stay:} Take the mean over all lengths of
        stay from the diabetic spells with that admission date.
    \item \textbf{Proportion of net costs:} Take the net cost for each diabetic
        spell beginning on that admission date and sum them, denote this by
        \(c_d\). Do the same with the net cost of all spells with that admission
        date and denote this by \(C\). Then the proportion of net costs spent on
        diabetic patients is given by \(\frac{c_d}{C}\).
\end{itemize}

The obvious benefit of taking the quantities in this way is that it allows for
the data to be arranged with some sense of time, but there is a glaring issue.
That being that the data will be misrepresented when manipulated in this way.
For instance, the length of a spell has no definitive connection to the
admission date of that spell. By grouping all the spells starting on that day
together and taking their mean, any adversely long spells will push the mean
upwards. Also, there is a time-related error when taking the net cost of a spell
on any one day in that spell since that cost was not truly spent or incurred on
that day necessarily.

Irrespective of these misrepresentations,
Figures~\ref{fig:admissions}~\--~\ref{fig:los_time} show how these quantities
evolve over the entire data period. In each case, the monthly and year means are
shown, and the standard deviation of the monthly averages in a year are given as
error bars. The data has been aggregated into monthly and yearly averages rather
than using the daily, or evenly weekly, data in an attempt to smooth out the
misrepresentation that is described above. In addition to these plotted points,
the data has been fitted with a standard linear regression model \-- the
statistics of which are given beneath the legend in each plot. These statistics
are the R-squared value and standard error. These statistics help to describe
the goodness of fit of the model and their definitions are given below.

\begin{definition}
    Consider a dataset with \(n\) values, denoted by \(x_1, \ldots, x_n\). Each
    of these data points has associated with it a predicted value obtained from
    the fitted model, denoted by \(y_1, \ldots, y_n\). Let the mean of the
    dataset be denoted by \(\bar x\). The \emph{coefficient of determination},
    denoted by \(R^2\), is defined to be:

    \[
        R^2 = 1 - \frac{\sum_{i=1}^{n} {\left(x_i - y_i\right)}^2}%
                       {\sum_{i=1}^{n} {\left(x_i - \bar x\right)}^2}
    \]

    Intuitively, the R-squared value represents the proportion of variation in
    the data that is explained by the model fitted, and thus should take a value
    in the interval \(\left[0, 1\right]\).
\end{definition}

\begin{definition}
    Consider a dataset with \(n\) values, \(x_1, \ldots, x_n\), and their
    corresponding predicted values, \(y_1, \ldots, y_n\). Then the
    \emph{standard error of the estimate}, denoted by \(SE\), is defined to be:

    \[
        SE = \sqrt{%
            \frac{\sum_{i=1}^{n} {\left(x_i - y_i\right)}^2}{n}
        }
    \]

    The standard error represents the average distance (error) of the data
    points from the regression line. The benefit of this statistic is that it
    gives a measure of the precision of the model on the scale of the variable
    that has been predicted.
\end{definition}

Figures~\ref{fig:admissions}~\&~\ref{fig:netcost_proportions} suggest that the
amount of resources consumed by the diabetic population is increasing, though
slowly. The former indicates that on average the number of diabetic patients
visiting the hospital is increasing slowly (approximately a one percent increase
over five years), and from the latter it is seen that the yearly average
proportion of net spending on diabetic patients has also experienced a shallow
increase of roughly half a percent over the same period. So, indeed, these plots
give evidence to support the claim.

In addition to this, both figures show a distinct divergence as time progresses
as shown by both the spread in the monthly averages and the widening of the
yearly error bars. This is an interesting phenomenon; there seems no apparent
reason for this variability to increase in recent years with improved policy on
prevention, diagnosis, management and treatment~\cite{NICE}.

With the final figure in this section it is clear that \-- despite the slight
increase in the proportion of net costs and the number of diabetic admissions
over the last five years \-- there has been a distinct decline in the average
length of stay for diabetic patients in the same period. This average has fallen
from one week to roughly five and a half days. This decrease is likely due, in
part, to the changes in NHS policy referenced above but also the ever-increasing
pressure put on the hospital system to move patients through the system
efficiently in order to save on idle costs such as ward costs and overheads.


\begin{figure}[htbp]
    \centering
    \includegraphics[width=.95\imgwidth]{admissions/main.pdf}
    \caption{Monthly averages for the proportion of daily admissions presenting
        diabetes. Fitted with a linear least-squares regression model.}%
    \label{fig:admissions}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=.95\imgwidth]{netcost_proportions/main.pdf}
    \caption{Monthly averages for the proportion of daily net cost spending
        toward diabetic patients given their admission date. Fitted with a
        linear least-squares regression model.}%
    \label{fig:netcost_proportions}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=.95\imgwidth]{los_time/main.pdf}
    \caption{Monthly averages for the average length of a diabetic patient's
        spell given their admission date. Fitted with a linear least-squares
        regression model.}%
    \label{fig:los_time}
\end{figure}

Across all three of the models summarised in the previous three figures, it is
clear that none exhibit a particularly strong goodness of fit; though they all
have appropriately small standard errors, the coefficients of determination are
moderate at best (in the case of admissions and length of stay) and minuscule
(in the case of net costs). This indicates that the models themselves are not
wholly suitable in any case.

It is notable, also, that there is a seasonal pattern in each of the plots which
is consistent with the linear models not performing well. The inclusion of
seasonal behaviour in a regression model has more to do more with the semantics
of finding a ``good'' regression model than was intended here but it is an
important concept nonetheless. If the purpose of this exercise was to accurately
predict the quantities being plotted rather than just seeing the general trend,
then a more elaborate model would have been fitted.
